<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mealkitz - Punto de Venta</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <!-- Google Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
        background-color: #f8f9fa;
        padding-top: 1rem;
      }
      .navbar {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
        background-color: #fff;
        margin-bottom: 1rem;
      }
      .navbar-brand {
        font-weight: 600;
        color: #123a62 !important;
      }
      .navbar-toggler {
        border: none;
      }
      .navbar-toggler-icon {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(18,58,98,0.8)' stroke-width='2' stroke-linecap='round' stroke-miterlimit='10' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
      }

      .btn {
        font-weight: normal;
        border-radius: 0.375rem;
        transition: all 0.2s ease-in-out;
      }
      .btn-primary {
        background-color: #123a62;
        color: #fff;
        border-color: #123a62;
      }
      .btn-primary:hover {
        background-color: #0e3150;
        border-color: #0e2d4e;
        transform: translateY(-1px);
      }
      .btn-secondary {
        background-color: #6c757d;
        color: #fff;
        border-color: #6c757d;
      }
      .btn-secondary:hover {
        background-color: #5a6268;
        transform: translateY(-1px);
      }
      .hero-blue-background {
        background-color: #123a62;
        color: #fff;
        padding: 2rem 1rem;
        border-radius: 0.5rem;
        margin-bottom: 1rem;
      }
      .hero-blue-background h1 {
        margin: 0;
        font-weight: normal;
      }
      .hero-blue-background .lead {
        color: #f1f1f1;
        font-size: 1rem;
      }
      main.container.custom-main {
        background: #fff;
        padding: 2rem;
        border-radius: 0.75rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        margin: 2rem auto;
        max-width: 800px;
      }
      @media (max-width: 767.98px) {
        .btn-lg.full-width-sm {
          display: block;
          width: 100%;
        }
      }

      #navbarIcons.collapsing {
        height: 0;
        overflow: hidden;
        transition: height 0.5s ease-in-out;
      }

      /* Action Card Styles */
      .action-card-grid {
        margin-top: 1.5rem;
      }
      .action-card {
        display: block;
        background-color: #ffffff;
        border-radius: 0.75rem;
        border: 1px solid #e9ecef;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        padding: 1.5rem;
        text-align: center;
        text-decoration: none;
        color: inherit;
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      .action-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        color: inherit;
      }
      .action-card-icon {
        font-size: 2.5rem;
        color: #123a62;
        margin-bottom: 0.75rem;
      }
      .action-card-title {
        font-size: 1rem;
        font-weight: 600;
        color: #343a40;
      }

      /* Basic POS Modal Styles */
      #posProductListContainer {
        max-height: 400px;
        overflow-y: auto;
        border: 1px solid #dee2e6;
        padding: 0.5rem;
        border-radius: 0.375rem;
      }
      .pos-product-item {
        cursor: pointer;
        padding: 0.75rem;
        border-bottom: 1px solid #eee;
      }
      .pos-product-item:hover {
        background-color: #f8f9fa;
      }
      .pos-product-item:last-child {
        border-bottom: none;
      }
      #posCartItemsContainer {
        min-height: 150px;
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid #dee2e6;
        padding: 1rem;
        background-color: #f8f9fa;
        border-radius: 0.375rem;
      }
      .pos-cart-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 0;
        border-bottom: 1px solid #e0e0e0;
      }
      .pos-cart-item:last-child {
        border-bottom: none;
      }
      .pos-cart-item-details span {
        display: block;
      }
      .pos-cart-item-name {
        font-weight: 600;
      }
      .pos-cart-item-qty-price {
        font-size: 0.9em;
        color: #6c757d;
      }
      #posTotalAmount {
        font-size: 1.5rem;
        font-weight: bold;
        color: #123a62;
        text-align: right;
        margin-top: 1rem;
      }
      /* End Basic POS Modal Styles */

      /* Custom Navbar Link Styling */
      @media (max-width: 767.98px) { /* Bootstrap's md breakpoint */
        .navbar-collapse .navbar-nav .nav-item {
          text-align: center;
        }
        .navbar-collapse .navbar-nav .nav-link {
          padding-top: 0.75rem;
          padding-bottom: 0.75rem;
          /* border-bottom: 1px solid #eee; */ /* Optional separator */
        }
        /* .navbar-collapse .navbar-nav .nav-item:last-child .nav-link {
          border-bottom: none;
        } */
        .navbar-collapse .navbar-nav {
          margin-top: 0.5rem;
        }
        .navbar-collapse .navbar-nav.me-auto {
            margin-right: 0 !important; /* Override me-auto for centering */
            margin-left: 0 !important;
            width: 100%;
        }
         .navbar-collapse .d-flex.ms-auto {
            width: 100%;
            justify-content: center;
            margin-top: 0.5rem;
            padding-bottom: 0.5rem;
        }
      }

      /* Desktop Navbar Link Centering */
      @media (min-width: 768px) {
        .navbar-collapse {
          /* justify-content: space-between; */ /* This might be too much if brand is not also flex item */
        }
        /* Attempt to center the me-auto block */
        .navbar-collapse ul.navbar-nav.me-auto {
            position: absolute; /* Take out of flow */
            left: 50%;
            transform: translateX(-50%); /* Center it */
            /* Ensure it doesn't overlap with other elements like brand or right-side icons */
            /* This might need adjustments based on the exact width of your brand and right-side icons */
        }
      }

      .navbar-nav .nav-link {
        transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
      }
      .navbar-nav .nav-link:hover,
      .navbar-nav .nav-link:focus {
        background-color: #e9ecef; /* Light hover/focus background */
        color: #0056b3; /* Darker blue for text on hover/focus */
        border-radius: 0.375rem; /* Rounded corners on hover */
      }
      .navbar-nav .nav-link i {
        font-size: 1.1em;
        vertical-align: text-bottom; /* Align icon better with text */
        margin-right: 0.35em !important; /* Ensure spacing from text */
      }

      /* Styles from hacemos.html for "Ideal para" and "Paso a Paso" sections */
      /* Steps Section */
      .steps-section {
        padding: 3rem 1rem;
      }
      .steps-section h3 {
        text-align: center;
        color: #123a62;
        margin-bottom: 2rem;
        font-weight: 600;
      }
      .step-card {
        background-color: #fefefe;
        border: 1px solid #e9ecef;
        border-radius: 0.75rem;
        padding: 1.5rem;
        text-align: center;
        transition: transform 0.2s, box-shadow 0.2s;
        height: 100%; /* Ensure cards in a row are same height */
      }
      .step-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.06);
      }
      .step-card i {
        font-size: 2rem;
        color: #123a62;
        margin-bottom: 0.75rem;
      }
      .step-card h5 {
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: #123a62;
      }
      .step-card p {
        font-size: 0.9rem;
        color: #6c757d;
      }

      /* "Ideal para" List */
      .ideal-section {
        padding: 2rem 1rem;
        margin-bottom: 2rem; /* Add some space before the next section */
      }
      .ideal-section h3 {
        text-align: center;
        color: #123a62;
        margin-bottom: 1.5rem;
        font-weight: 600;
      }
      .ideal-section ul li {
        margin-bottom: 0.75rem;
        font-size: 0.95rem;
        font-weight: 400;
      }
      .ideal-section ul li i {
        color: #28a745; /* Green checkmark icons */
        margin-right: 0.5rem;
      }
      /* End of styles from hacemos.html */
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-light bg-white navbar-expand-md py-2">
      <div class="container-fluid px-4">
        <a class="navbar-brand d-flex align-items-center" href="index.html">
          <img
            src="Images/mk_logo.jpeg"
            style="height: 35px; margin-right: 5px;"
            alt="Mealkitz Logo"
          />
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarIcons"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
    
        <div class="collapse navbar-collapse" id="navbarIcons">
          <!-- IZQUIERDA: enlaces a cada acción -->
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <!-- Ingresar tus Datos -->
            <li class="nav-item">
              <a class="nav-link" href="config.html">
                <i class="bi bi-person-badge-fill me-1"></i>
                Ingresar tus Datos
              </a>
            </li>
    
            <!-- Cobro Manual (abre modal) -->
            <li class="nav-item">
              <a
                class="nav-link"
                href="#"
                data-bs-toggle="modal"
                data-bs-target="#basicPosModal"
              >
                <i class="bi bi-calculator-fill me-1"></i>
                Punto de Venta
              </a>
            </li>
    
            <!-- Generar Cotización (abre modal) -->
            <li class="nav-item">
              <a
                class="nav-link"
                href="#"
                data-bs-toggle="modal"
                data-bs-target="#cotizacionModal"
              >
                <i class="bi bi-file-earmark-text-fill me-1"></i>
                Generar Cotización
              </a>
            </li>
    
            <!-- Cobro con QR (abre modal "Próximamente") -->
            <li class="nav-item">
              <a
                class="nav-link"
                href="#"
                data-bs-toggle="modal"
                data-bs-target="#proximamenteQRModal"
              >
                <i class="bi bi-qr-code me-1"></i>
                Cobro con QR
              </a>
            </li>
    
            <!-- Tu Tienda En Línea -->
            <li class="nav-item">
              <a class="nav-link" href="e-commerce.html">
                <i class="bi bi-shop me-1"></i>
                Tu Tienda En Línea
              </a>
            </li>
    
            <!-- Pedidos -->
            <li class="nav-item">
              <a class="nav-link" href="pedidos.html">
                <i class="bi bi-box-seam me-1"></i>
                Pedidos
              </a>
            </li>
    
            <!-- Ayuda -->
            <li class="nav-item">
              <a class="nav-link" href="ayuda.html">
                <i class="bi bi-question-circle-fill me-1"></i>
                Ayuda
              </a>
            </li>
          </ul>
    
          <!-- DERECHA: notificaciones, compartir, perfil y buscador -->
          <div class="d-flex align-items-center ms-auto">
            <button class="btn btn-link text-dark me-3" title="Notificaciones">
              <i class="bi bi-bell-fill fs-4"></i>
            </button>
            <a
              href="#"
              id="whatsapp-share-btn"
              class="btn btn-link text-dark me-3"
              title="Compartir en WhatsApp"
            >
              <i class="bi bi-whatsapp fs-4"></i>
            </a>
            <div class="nav-item dropdown">
              <a
                href="#"
                class="btn btn-link text-dark me-3 dropdown-toggle d-flex align-items-center"
                id="profileDropdown"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                title="Perfil"
              >
                <img
                  id="profileImageLogo"
                  src=""
                  alt="Profile Logo"
                  style="height: 28px; width: 28px; border-radius: 50%; margin-right: 8px; display: none;"
                />
                <i class="bi bi-person-circle fs-4 me-2" id="defaultProfileIcon"></i>
                <span id="profileDropdownName">Perfil</span>
              </a>
              <ul
                class="dropdown-menu dropdown-menu-end"
                aria-labelledby="profileDropdown"
                id="profileDropdownMenu"
              >
                <li>
                  <a class="dropdown-item" href="perfil.html" id="viewProfileLink"
                    >Crear Perfil</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    href="iniciar.html"
                    id="loginOrLogoutLink"
                    >Iniciar Sesión</a
                  >
                </li>
              </ul>
        </div>
      </div>
    </nav>

    <main class="container custom-main">
      <section class="hero-blue-background text-left">
        <h1>Mealkitz.io (DEMO)</h1>
        <p class="lead">
          Esta es una herramienta para configurar productos, iniciar cobros y
          gestionar tu tienda en línea.
        </p>
      </section>

      <!-- "Ideal para" Section from hacemos.html -->
      <section class="ideal-section">
        <h3>Ideal para</h3>
        <div class="row gx-4 gy-3">
          <div class="col-6 col-md-3">
            <ul class="list-unstyled">
              <li><i class="bi bi-check-circle-fill"></i>Bakery casera</li>
              <li><i class="bi bi-check-circle-fill"></i>Food truck</li>
              <li><i class="bi bi-check-circle-fill"></i>Restaurante pop-up</li>
            </ul>
      </div>
          <div class="col-6 col-md-3">
            <ul class="list-unstyled">
              <li><i class="bi bi-check-circle-fill"></i>Cocina oculta</li>
              <li><i class="bi bi-check-circle-fill"></i>Catering pequeño</li>
              <li><i class="bi bi-check-circle-fill"></i>Artesanías alimenticias</li>
            </ul>
          </div>
          <div class="col-6 col-md-3">
            <ul class="list-unstyled">
              <li><i class="bi bi-check-circle-fill"></i>Jabones y cremas</li>
              <li><i class="bi bi-check-circle-fill"></i>Consultoría</li>
              <li><i class="bi bi-check-circle-fill"></i>Chef privado</li>
            </ul>
          </div>
          <div class="col-6 col-md-3">
            <ul class="list-unstyled">
              <li><i class="bi bi-check-circle-fill"></i>Talleres de cocina</li>
              <li><i class="bi bi-check-circle-fill"></i>Fonda</li>
              <li><i class="bi bi-check-circle-fill"></i>Almuerzos corporativos</li>
            </ul>
          </div>
        </div>
      </section>
      <!-- End "Ideal para" Section -->

      <!-- "Paso a Paso" Section from hacemos.html -->
      <section class="steps-section my-5">
        <h3>Paso a Paso</h3>
        <div class="row g-4">
          <div class="col-12 col-sm-6 col-lg-3">
            <div class="step-card h-100">
              <i class="bi bi-person-plus-fill"></i>
              <h5>1. Regístrate</h5>
              <p>Regístrate gratis con nombre, correo y contraseña.</p>
            </div>
          </div>
          <div class="col-12 col-sm-6 col-lg-3">
            <div class="step-card h-100">
              <i class="bi bi-gear-fill"></i>
              <h5>2. Configura tu negocio</h5>
              <p>Agrega ubicación, datos fiscales y catálogo de productos.</p>
            </div>
          </div>
          <div class="col-12 col-sm-6 col-lg-3">
            <div class="step-card h-100">
              <i class="bi bi-receipt-cutoff"></i>
              <h5>3. Factura</h5>
              <p>Emite facturas electrónicas con validación automática.</p>
            </div>
          </div>
          <div class="col-12 col-sm-6 col-lg-3">
            <div class="step-card h-100">
              <i class="bi bi-basket3-fill"></i>
              <h5>4. Gestiona pedidos</h5>
              <p>Centraliza pedidos, controla inventario y reportes en tiempo real.</p>
            </div>
          </div>
        </div>
      </section>
      <!-- End "Paso a Paso" Section -->

      <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-4 action-card-grid">
        <!-- Ingresar tus Datos -->
        <div class="col">
          <a href="config.html" class="action-card">
            <div class="action-card-icon"><i class="bi bi-person-badge-fill"></i></div>
            <div class="action-card-title">Ingresar tus Datos</div>
          </a>
        </div>

        <!-- Cobro Manual -->
        <div class="col">
          <a href="#" class="action-card" data-bs-toggle="modal" data-bs-target="#basicPosModal">
            <div class="action-card-icon"><i class="bi bi-calculator-fill"></i></div>
            <div class="action-card-title">Punto de Venta</div>
          </a>
        </div>

        <!-- Generar Cotización -->
        <div class="col">
          <a href="#" class="action-card" data-bs-toggle="modal" data-bs-target="#cotizacionModal">
            <div class="action-card-icon"><i class="bi bi-file-earmark-text-fill"></i></div>
            <div class="action-card-title">Generar Cotización</div>
          </a>
        </div>

        <!-- Cobro con QR -->
        <div class="col">
          <a href="#" class="action-card" data-bs-toggle="modal" data-bs-target="#proximamenteQRModal">
            <div class="action-card-icon"><i class="bi bi-qr-code"></i></div>
            <div class="action-card-title">Cobro con QR</div>
          </a>
        </div>

        <!-- Tu Tienda En Línea -->
        <div class="col">
          <a href="e-commerce.html" class="action-card">
            <div class="action-card-icon"><i class="bi bi-shop"></i></div>
            <div class="action-card-title">Tu Tienda En Línea</div>
          </a>
        </div>

        <!-- Pedidos -->
        <div class="col">
          <a href="pedidos.html" class="action-card">
            <div class="action-card-icon"><i class="bi bi-box-seam"></i></div>
            <div class="action-card-title">datos.html</div>
          </a>
        </div>

    </main>

    <!-- Basic POS Modal -->
    <div class="modal fade" id="basicPosModal" tabindex="-1" aria-labelledby="basicPosModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="basicPosModalLabel">Punto de Venta</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <div class="row">
              <!-- Left Column: Product Selection -->
              <div class="col-md-5">
                <h6>Productos Disponibles</h6>
                <input type="text" id="posProductFilter" class="form-control mb-2" placeholder="Buscar producto...">
                <div id="posProductListContainer">
                  <!-- Product items will be dynamically added here by JavaScript -->
                  <div class="text-muted p-2">Cargando productos...</div>
                </div>
              </div>

              <!-- Right Column: Cart/Order Summary -->
              <div class="col-md-7">
                <h6>Resumen del Pedido</h6>
                <div id="posCartItemsContainer">
                  <p class="text-muted text-center mt-3">El carrito está vacío.</p>
                  <!-- Cart items will be dynamically added here by JavaScript -->
                </div>
                <div id="posTotalAmount" class="mt-3">
                  Total: $0.00
                </div>
                <div class="mt-3">
                  <label for="posPaymentMethod" class="form-label">Método de Pago</label>
                  <select id="posPaymentMethod" class="form-select">
                    <option value="efectivo" selected>Efectivo</option>
                    <option value="tarjeta">Tarjeta</option>
                    <option value="transferencia">Transferencia</option>
                    <option value="yappy">Yappy</option>
                    <!-- Add other payment methods as needed -->
            </select>
          </div>
                <div class="mb-3 mt-3">
                    <label for="posClientWhatsapp" class="form-label">WhatsApp Cliente (Opcional)</label>
                    <input type="tel" id="posClientWhatsapp" class="form-control" placeholder="Ej: +507 6xxxxxxx">
          </div>
        </div>
      </div>
    </div>
          <div class="modal-footer justify-content-between">
            <button type="button" class="btn btn-warning" id="posClearCartBtn">Limpiar Pedido</button>
            <div>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" id="posProcessPaymentBtn">Procesar Cobro</button>
          </div>
          </div>
        </div>
      </div>
    </div>
    <!-- End Basic POS Modal -->

    <!-- Modal Único: Cobro Manual (con checkbox para encuesta) -->
    <div
      class="modal fade"
      id="manualChargeModal"
      tabindex="-1"
      aria-labelledby="manualChargeModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="manualChargeModalLabel">
              Cobro Manual
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Cerrar"
            ></button>
          </div>
          <div class="modal-body">
            <form id="manualChargeForm">
              <!-- 1) Selección de Producto -->
              <div class="mb-3">
                <label for="mcProduct" class="form-label"
                  >Selecciona un producto</label
                >
                <select
                  id="mcProduct"
                  class="form-select"
                  required
                  aria-describedby="mcProductHelp"
                >
                  <option value="" selected disabled>
                    Elige un producto...
                  </option>
                </select>
                <div id="mcProductHelp" class="form-text">
                  Elige de tu catálogo el producto que deseas cobrar.
            </div>
          </div>

              <!-- 2) Revisión de datos (negocio, fecha y precio) -->
              <div class="row mb-3">
                <div class="col-md-4">
                  <label for="mcBusiness" class="form-label">Negocio</label>
                  <input
                    type="text"
                    id="mcBusiness"
                    class="form-control"
                    readonly
                    placeholder="Negocio"
                  />
        </div>
                <div class="col-md-4">
                  <label for="mcDatetime" class="form-label">Fecha / Hora</label>
                  <input
                    type="text"
                    id="mcDatetime"
                    class="form-control"
                    readonly
                    placeholder="Fecha y Hora"
                  />
      </div>
                <div class="col-md-4">
                  <label for="mcPrice" class="form-label">Precio</label>
                  <input
                    type="number"
                    step="0.01"
                    id="mcPrice"
                    class="form-control"
                    readonly
                    placeholder="Precio"
                  />
    </div>
              </div>

              <!-- 3) Método de pago -->
              <div class="mb-3">
                <label class="form-label">Método de pago</label>
                <div
                  id="mcPaymentMethodsContainer"
                  class="d-flex gap-2 flex-wrap"
                >
                  <!-- Botones de métodos se insertarán por JavaScript -->
                </div>
                <div id="mcPaymentHelp" class="form-text">
                  Selecciona cómo deseas que el cliente pague.
                </div>
              </div>

              <!-- 4) WhatsApp del cliente (opcional) -->
              <div class="mb-3">
                <label for="mcWhatsapp" class="form-label"
                  >Número de WhatsApp (opcional)</label
                >
                <input
                  type="tel"
                  id="mcWhatsapp"
                  class="form-control"
                  placeholder="Ej: +507 6123-4567"
                />
                <div id="mcWhatsappHelp" class="form-text">
                  Si desea enviar confirmación automática por WhatsApp.
                </div>
              </div>

              <!-- 5) Checkbox: Enviar encuesta -->
              <div class="form-check mb-3">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="mcSurvey"
                />
                <label class="form-check-label" for="mcSurvey">
                  Deseo recibir encuesta después de mi compra
                </label>
              </div>

              <!-- 6) Botón Finalizar Cobro -->
              <div class="text-end mt-4">
                <button
                  type="submit"
                  id="mcSubmit"
                  class="btn btn-success"
                  disabled
                >
                  Procesar y Enviar
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Cotización Modal -->
    <div
      class="modal fade"
      id="cotizacionModal"
      tabindex="-1"
      aria-labelledby="cotizacionModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="cotizacionModalLabel">
              Generador de Cotización
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Cerrar"
            ></button>
          </div>
          <div class="modal-body">
            <form id="cotizacionForm">
              <div class="mb-3">
                <label for="cotizacionClienteNombre" class="form-label"
                  >Nombre del Cliente</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="cotizacionClienteNombre"
                  required
                />
          </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="cotizacionClienteEmail" class="form-label"
                    >Correo Electrónico del Cliente</label
                  >
                  <input
                    type="email"
                    class="form-control"
                    id="cotizacionClienteEmail"
                    required
                  />
          </div>
                <div class="col-md-6 mb-3">
                  <label for="cotizacionClienteTelefono" class="form-label"
                    >Teléfono del Cliente (Opcional)</label
                  >
                  <input
                    type="tel"
                    class="form-control"
                    id="cotizacionClienteTelefono"
                  />
        </div>
      </div>
              <div class="mb-3">
                <label for="cotizacionDescripcion" class="form-label"
                  >Descripción de Servicios/Productos</label
                >
                <textarea
                  class="form-control"
                  id="cotizacionDescripcion"
                  rows="4"
                  placeholder="Detallar los ítems de la cotización, uno por línea si es posible. Ej:
Diseño de Logo - $XXX
Desarrollo Web Básico - $YYY"
                  required
                ></textarea>
    </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="cotizacionMontoTotal" class="form-label"
                    >Monto Total de la Cotización</label
                  >
                  <div class="input-group">
                    <span class="input-group-text" id="cotizacionCurrencySymbol"
                      >$</span
                    >
                    <input
                      type="number"
                      class="form-control"
                      id="cotizacionMontoTotal"
                      step="0.01"
                      required
                    />
                  </div>
                </div>
              </div>
              <div class="mb-3">
                <label for="cotizacionNotas" class="form-label"
                  >Notas Adicionales (Opcional)</label
                >
                <textarea
                  class="form-control"
                  id="cotizacionNotas"
                  rows="2"
                  placeholder="Ej: Validez de la cotización: 30 días. Condiciones de pago."
                ></textarea>
              </div>
              <div class="form-text mb-3">
                Esta cotización utilizará los datos de tu negocio configurados (si
                aplica para la presentación).
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cerrar
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="generarCotizacionBtn"
            >
              Generar y Enviar Cotización
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- End Cotización Modal -->

    <!-- Modal Próximamente QR -->
    <div
      class="modal fade"
      id="proximamenteQRModal"
      tabindex="-1"
      aria-labelledby="proximamenteQRModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="proximamenteQRModalLabel">
              Funcionalidad Avanzada
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Cerrar"
            ></button>
        </div>
          <div class="modal-body">
            <p>
              Cobros con QR, Reportes avanzados e acceso a inversiones son
              funciones avanzadas que se desbloquearán al usar el sistema de forma
              constante.
            </p>
      </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
              Entendido
            </button>
    </div>
        </div>
      </div>
    </div>
    <!-- End Modal Próximamente QR -->

    <!-- Modal de Inicio de Sesión Requerido -->
    <div class="modal fade" id="loginRequiredModal" tabindex="-1" aria-labelledby="loginRequiredModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="loginRequiredModalLabel"><i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>Inicio de Sesión Requerido</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <p>Para acceder a esta función, por favor, inicia sesión o crea una cuenta.</p>
          </div>
          <div class="modal-footer justify-content-center">
            <a href="iniciar.html" class="btn btn-primary">Iniciar Sesión</a>
            <a href="iniciar.html?action=register" class="btn btn-success">Crear Cuenta</a>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/navbar-loader.js" defer></script>
    <script src="js/auth-navbar.js" defer></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- BEGIN NEW FEATURE GATING AND LOGIN CHECK --- 
        const loginRequiredModalEl = document.getElementById('loginRequiredModal');
        const loginRequiredModalInstance = loginRequiredModalEl ? new bootstrap.Modal(loginRequiredModalEl) : null;
        let postLoginRedirectData = null;

        try {
            const postLoginRedirectRAW = sessionStorage.getItem('postLoginRedirect');
            if (postLoginRedirectRAW) {
                postLoginRedirectData = JSON.parse(postLoginRedirectRAW);
            }
        } catch (e) {
            console.error("Error parsing postLoginRedirect from sessionStorage:", e);
            sessionStorage.removeItem('postLoginRedirect');
        }

        const currentUser = localStorage.getItem('currentUser_mealkitz');

        // If not logged in AND no postLoginRedirect is active for this page, redirect to login.
        // This protects direct access to punto.html if not logged in.
        if (!currentUser && (!postLoginRedirectData || postLoginRedirectData.page !== 'punto.html')) {
            window.location.href = 'iniciar.html?redirect=punto.html'; // Add redirect param for context
            return; // Stop further script execution on this page
        }

        const commonLoginCheck = (event, destination) => {
            if (!currentUser) { // currentUser is already fetched at the top of DOMContentLoaded
                if (event) event.preventDefault();
                if (loginRequiredModalInstance) {
                    sessionStorage.setItem('postLoginRedirect', JSON.stringify(destination));
                    loginRequiredModalInstance.show();
                } else {
                    console.error('Login Required Modal not found or initialized on punto.html.');
                    window.location.href = 'iniciar.html';
                }
                return false;
            }
            return true;
        };

        // After login, if redirected back with a hash for a modal on *this* page (punto.html):
        if (postLoginRedirectData && postLoginRedirectData.page === 'punto.html' && postLoginRedirectData.hash) {
            const targetModalId = postLoginRedirectData.hash.substring(1); // remove #
            const modalElement = document.getElementById(targetModalId);
            if (modalElement) {
                const modalInstance = bootstrap.Modal.getInstance(modalElement) || new bootstrap.Modal(modalElement);
                if (modalInstance) modalInstance.show();
            }
            sessionStorage.removeItem('postLoginRedirect'); // Clear after processing
        }

        // Gate action cards and navbar links that navigate or open modals
        // Example: Link to config.html
        document.querySelectorAll('a[href="config.html"]').forEach(link => {
            link.addEventListener('click', function(event) {
                commonLoginCheck(event, { page: 'config.html' });
            });
        });
        // Example: Modal trigger for #manualChargeModal
        document.querySelectorAll('[data-bs-target="#manualChargeModal"]').forEach(trigger => {
            trigger.addEventListener('click', function(event) {
                commonLoginCheck(event, { page: 'punto.html', hash: '#manualChargeModal' });
            });
        });
        // Add more for other modals and links as needed, e.g.:
        // Cotizacion Modal
        document.querySelectorAll('[data-bs-target="#cotizacionModal"]').forEach(trigger => {
            trigger.addEventListener('click', function(event) {
                commonLoginCheck(event, { page: 'punto.html', hash: '#cotizacionModal' });
            });
        });
        // Proximamente QR Modal (though it's informational, good practice)
        document.querySelectorAll('[data-bs-target="#proximamenteQRModal"]').forEach(trigger => {
            trigger.addEventListener('click', function(event) {
                commonLoginCheck(event, { page: 'punto.html', hash: '#proximamenteQRModal' });
            });
        });
        // Tu Tienda En Línea
        document.querySelectorAll('a[href="e-commerce.html"]').forEach(link => {
            link.addEventListener('click', function(event) {
                commonLoginCheck(event, { page: 'e-commerce.html' });
            });
        });
        // Pedidos
        document.querySelectorAll('a[href="pedidos.html"]').forEach(link => {
            link.addEventListener('click', function(event) {
                commonLoginCheck(event, { page: 'pedidos.html' });
            });
        });
         // Ayuda (assuming it doesn't require login, so no check needed. If it does, add it)
         // document.querySelectorAll('a[href="ayuda.html"]').forEach(link => { ... });

        // --- END NEW FEATURE GATING AND LOGIN CHECK ---

        // Cargar configuración (negocio, productos, métodos de pago) desde localStorage
        let mealkitzConfig = {};
        try {
          const storedConfig = localStorage.getItem("mealkitzConfig");
          console.log("Stored mealkitzConfig from localStorage:", storedConfig); // Log what's retrieved
          if (storedConfig) {
            mealkitzConfig = JSON.parse(storedConfig);
          } else {
            mealkitzConfig = {
              business: { name: "Mi Tienda (defecto)", currency: "$" },
              payments: { methods: ["Efectivo"] },
              products: [],
            };
          }
        } catch {
          mealkitzConfig = {
            business: { name: "Mi Tienda (defecto)", currency: "$" },
            payments: { methods: ["Efectivo"] },
            products: [],
          };
        }
        // Si no hay productos configurados, ejemplo por defecto
        if (
          !Array.isArray(mealkitzConfig.products) ||
          mealkitzConfig.products.length === 0
        ) {
          mealkitzConfig.products = [
            { id: 1, name: "Producto A", price: 10.0 },
            { id: 2, name: "Producto B", price: 15.5 },
            { id: 3, name: "Producto C", price: 7.25 },
          ];
        }
        // Variables DOM
        const mcProduct = document.getElementById("mcProduct");
        const mcBusiness = document.getElementById("mcBusiness");
        const mcDatetime = document.getElementById("mcDatetime");
        const mcPrice = document.getElementById("mcPrice");
        const mcPaymentContainer = document.getElementById("mcPaymentMethodsContainer");
        const mcWhatsapp = document.getElementById("mcWhatsapp");
        const mcSurvey = document.getElementById("mcSurvey");
        const mcSubmit = document.getElementById("mcSubmit");

        // Rellenar select de productos
        function populateProductSelect() {
          mcProduct.innerHTML =
            '<option value="" disabled selected>Elige un producto...</option>';
          mealkitzConfig.products.forEach((p, idx) => {
            const opt = document.createElement("option");
            opt.value = idx;
            opt.textContent = `${p.name} - ${
              mealkitzConfig.business.currency
            }${p.price.toFixed(2)}`;
            mcProduct.appendChild(opt);
          });
        }
        // Rellenar métodos de pago
        function populatePaymentMethods() {
          mcPaymentContainer.innerHTML = "";
          let methods = ["Efectivo"];
          if (
            mealkitzConfig.payments &&
            Array.isArray(mealkitzConfig.payments.methods) &&
            mealkitzConfig.payments.methods.length > 0
          ) {
            methods = mealkitzConfig.payments.methods;
          }
          methods.forEach((m) => {
            const btn = document.createElement("button");
            btn.type = "button";
            btn.className = "btn btn-outline-primary me-2 mb-2 pay-btn";
            btn.textContent = m.charAt(0).toUpperCase() + m.slice(1);
            btn.dataset.pay = m;
            mcPaymentContainer.appendChild(btn);
          });
        }
        // Estado de orden en memoria
        let currentOrder = {
          product: null,
          paymentMethod: null,
          whatsapp: "",
          survey: false,
        };
        // Cuando cambia producto:
        mcProduct.addEventListener("change", () => {
          const idx = parseInt(mcProduct.value, 10);
          const selected = mealkitzConfig.products[idx];
          if (selected) {
            currentOrder.product = selected;
            mcBusiness.value = mealkitzConfig.business.name;
            mcDatetime.value = new Date().toLocaleString();
            mcPrice.value = selected.price.toFixed(2);
          }
          updateSubmitState();
        });
        // Cuando selecciona método de pago:
        mcPaymentContainer.addEventListener("click", (e) => {
          if (e.target.classList.contains("pay-btn")) {
            // Limpiar clases "activo"
            document
              .querySelectorAll("#mcPaymentMethodsContainer .pay-btn")
              .forEach((b) => {
                b.classList.remove("btn-primary");
                b.classList.add("btn-outline-primary");
              });
            // Marcar este botón como activo
            e.target.classList.remove("btn-outline-primary");
            e.target.classList.add("btn-primary");
            currentOrder.paymentMethod = e.target.dataset.pay;
          }
          updateSubmitState();
        });
        // Cuando cambia WhatsApp:
        mcWhatsapp.addEventListener("input", () => {
          currentOrder.whatsapp = mcWhatsapp.value.trim();
        });
        // Checkbox encuesta:
        mcSurvey.addEventListener("change", () => {
          currentOrder.survey = mcSurvey.checked;
        });
        // Habilitar botón de submit solo si hay producto y método de pago
        function updateSubmitState() {
          if (currentOrder.product && currentOrder.paymentMethod) {
            mcSubmit.removeAttribute("disabled");
          } else {
            mcSubmit.setAttribute("disabled", "true");
          }
        }
        // Manejo del formulario de Cobro Manual
        document
          .getElementById("manualChargeForm")
          .addEventListener("submit", (ev) => {
            ev.preventDefault();
            // Construir mensaje de confirmación
            const p = currentOrder.product;
            const payM = currentOrder.paymentMethod;
            const wsp = currentOrder.whatsapp.replace(/\D/g, "");
            let msg = `¡Hola! Quiero ordenar: ${p.name} por ${
              mealkitzConfig.business.currency
            }${p.price.toFixed(2)}. Método de pago: ${payM}.`;
            if (currentOrder.survey) {
              msg += " Por favor, envíenme la encuesta de satisfacción.";
            }
            const finalMsg = wsp
              ? `${msg} Mi WhatsApp: +${wsp}`
              : msg + " (No proporcionó WhatsApp).";
            // Enviar por WhatsApp a número fijo del negocio:
            const negocioWA = "507XXXXXXXX"; // <-- Ajustar al WA real del negocio
            const urlWA = `https://wa.me/${negocioWA}?text=${encodeURIComponent(
              finalMsg
            )}`;
            window.open(urlWA, "_blank");
            // Reiniciar estado:
            document.getElementById("manualChargeForm").reset();
            currentOrder = {
              product: null,
              paymentMethod: null,
              whatsapp: "",
              survey: false,
            };
            updateSubmitState();
            bootstrap
              .Modal.getInstance(
                document.getElementById("manualChargeModal")
              )
              .hide();
            alert("Pedido procesado (simulación). Revisa WhatsApp para confirmar.");
          });

        // Al abrir el modal, poblamos todo
        document
          .getElementById("manualChargeModal")
          .addEventListener("show.bs.modal", () => {
            populateProductSelect();
            populatePaymentMethods();
            mcBusiness.value = "";
            mcDatetime.value = "";
            mcPrice.value = "";
            mcWhatsapp.value = "";
            mcSurvey.checked = false;
            updateSubmitState();
          });

        // --- BEGIN Basic POS Modal Logic ---
        const posModalElement = document.getElementById('basicPosModal');
        const posProductListContainer = document.getElementById('posProductListContainer');
        const posProductFilterInput = document.getElementById('posProductFilter');
        const posCartItemsContainer = document.getElementById('posCartItemsContainer');
        const posTotalAmountDiv = document.getElementById('posTotalAmount');
        const posPaymentMethodSelect = document.getElementById('posPaymentMethod');
        const posClientWhatsappInput = document.getElementById('posClientWhatsapp');
        const posClearCartBtn = document.getElementById('posClearCartBtn');
        const posProcessPaymentBtn = document.getElementById('posProcessPaymentBtn');
        
        let posCart = []; // Array to store { id, name, price, quantity }

        function formatCurrency(amount) {
            const currencySymbol = mealkitzConfig.business && mealkitzConfig.business.currency ? mealkitzConfig.business.currency : '$';
            return `${currencySymbol}${Number(amount).toFixed(2)}`;
        }

        function renderPosProducts(filterText = '') {
            if (!posProductListContainer) return;
            posProductListContainer.innerHTML = ''; // Clear previous items
            const productsToDisplay = mealkitzConfig.products.filter(p => 
                p.name.toLowerCase().includes(filterText.toLowerCase())
            );

            if (productsToDisplay.length === 0) {
                posProductListContainer.innerHTML = '<div class="text-muted p-2">No hay productos que coincidan o no hay productos configurados.</div>';
                return;
            }

            productsToDisplay.forEach(product => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'pos-product-item d-flex justify-content-between align-items-center';
                itemDiv.innerHTML = `
                    <span>${product.name} - ${formatCurrency(product.price)}</span>\n                    <button class="btn btn-sm btn-outline-primary add-to-cart-btn" data-product-id="${product.id}"><i class="bi bi-plus-lg"></i></button>\n                `;
                itemDiv.querySelector('.add-to-cart-btn').addEventListener('click', () => addProductToPosCart(product.id));
                posProductListContainer.appendChild(itemDiv);
            });
        }

        function addProductToPosCart(productId) {
            const product = mealkitzConfig.products.find(p => p.id === productId);
            if (!product) return;

            const existingCartItem = posCart.find(item => item.id === productId);
            if (existingCartItem) {
                existingCartItem.quantity++;
            } else {
                posCart.push({ ...product, quantity: 1 });
            }
            renderPosCart();
        }

        function renderPosCart() {
            if (!posCartItemsContainer || !posTotalAmountDiv) return;
            posCartItemsContainer.innerHTML = '';
            let currentTotal = 0;

            if (posCart.length === 0) {
                posCartItemsContainer.innerHTML = '<p class="text-muted text-center mt-3">El carrito está vacío.</p>';
            } else {
                posCart.forEach(item => {
                    const itemSubtotal = item.price * item.quantity;
                    currentTotal += itemSubtotal;
                    const cartItemDiv = document.createElement('div');
                    cartItemDiv.className = 'pos-cart-item';
                    cartItemDiv.innerHTML = `
                        <div class="pos-cart-item-details">
                            <span class="pos-cart-item-name">${item.name}</span>\n                            <span class="pos-cart-item-qty-price">${item.quantity} x ${formatCurrency(item.price)} = ${formatCurrency(itemSubtotal)}</span>\n                        </div>\n                        <div>\n                            <button class="btn btn-sm btn-outline-secondary decrease-qty-btn me-1" data-cart-item-id="${item.id}"><i class="bi bi-dash-lg"></i></button>\n                            <button class="btn btn-sm btn-outline-danger remove-item-btn" data-cart-item-id="${item.id}"><i class="bi bi-trash3"></i></button>\n                        </div>\n                    `;
                    cartItemDiv.querySelector('.decrease-qty-btn').addEventListener('click', () => decreasePosCartItemQuantity(item.id));
                    cartItemDiv.querySelector('.remove-item-btn').addEventListener('click', () => removeFromPosCart(item.id));
                    posCartItemsContainer.appendChild(cartItemDiv);
                });
            }
            posTotalAmountDiv.textContent = `Total: ${formatCurrency(currentTotal)}`;
            posProcessPaymentBtn.disabled = posCart.length === 0;
        }

        function decreasePosCartItemQuantity(productId) {
            const cartItem = posCart.find(item => item.id === productId);
            if (cartItem) {
                cartItem.quantity--;
                if (cartItem.quantity <= 0) {
                    removeFromPosCart(productId);
                } else {
                    renderPosCart();
                }
            }
        }

        function removeFromPosCart(productId) {
            posCart = posCart.filter(item => item.id !== productId);
            renderPosCart();
        }

        function clearPosCart() {
            posCart = [];
            if(posClientWhatsappInput) posClientWhatsappInput.value = '';
            if(posPaymentMethodSelect) posPaymentMethodSelect.selectedIndex = 0;
            renderPosCart();
        }

        function processPosPayment() {
            console.log("processPosPayment: Function started"); // Trace 1
            if (posCart.length === 0) {
                alert('El carrito está vacío.');
                console.log("processPosPayment: Cart empty, exiting."); // Trace 
                return;
            }
            const paymentMethod = posPaymentMethodSelect ? posPaymentMethodSelect.value : 'No especificado';
            const clientWhatsapp = posClientWhatsappInput ? posClientWhatsappInput.value.trim().replace(/\D/g, "") : '';
            let orderSummary = "Resumen de Pedido:\\n";
            let totalForMessage = 0;
            posCart.forEach(item => {
                orderSummary += `${item.name} (x${item.quantity}) - ${formatCurrency(item.price * item.quantity)}\\n`;
                totalForMessage += item.price * item.quantity;
            });
            orderSummary += `\\nTotal: ${formatCurrency(totalForMessage)}`;
            orderSummary += `\\nMétodo de Pago: ${paymentMethod.charAt(0).toUpperCase() + paymentMethod.slice(1)}`;
            
            const businessName = mealkitzConfig.business && mealkitzConfig.business.name ? mealkitzConfig.business.name : 'tu negocio';
            let confirmationMessage = `¡Gracias por tu compra en ${businessName}!\\n${orderSummary}`;

            if (clientWhatsapp) {
                confirmationMessage += `\\nConfirmación enviada a WhatsApp: +${clientWhatsapp}`;
            }
            
            console.log("processPosPayment: About to log simulation details."); // Trace 2
            console.log("Procesando Cobro (Simulación):", posCart, `Total: ${formatCurrency(totalForMessage)}`, `Método: ${paymentMethod}`, `Cliente WA: ${clientWhatsapp}`);
            
            console.log("processPosPayment: Checking for business WhatsApp."); // Trace 3
            const negocioWA = mealkitzConfig.business && mealkitzConfig.business.whatsapp ? mealkitzConfig.business.whatsapp.replace(/\D/g, "") : "";
            if (negocioWA) {
                console.log("processPosPayment: Business WhatsApp found:", negocioWA); // Trace 4
                let businessOrderMessage = `Nuevo Pedido POS (${businessName}):\\n`;
                posCart.forEach(item => {
                    businessOrderMessage += `${item.name} (x${item.quantity}) - ${formatCurrency(item.price * item.quantity)}\\n`;
                });
                businessOrderMessage += `Total: ${formatCurrency(totalForMessage)}\\nMétodo: ${paymentMethod}`;
                if (clientWhatsapp) {
                    businessOrderMessage += `\\nCliente WA: +${clientWhatsapp}`;
                }
                const urlWABusiness = `https://wa.me/${negocioWA}?text=${encodeURIComponent(businessOrderMessage)}`;
                console.log("processPosPayment: Opening business WhatsApp link:", urlWABusiness); // Trace 5
                window.open(urlWABusiness, '_blank');
            } else {
                console.log("processPosPayment: Business WhatsApp NOT found or configured."); // Trace 6
                alert("Número de WhatsApp del negocio no configurado para enviar el pedido.");
            }

            console.log("processPosPayment: About to show final alert."); // Trace 7
            alert(`Cobro procesado (simulación).\\n${confirmationMessage}`);
            
            console.log("processPosPayment: About to clear cart."); // Trace 8
            clearPosCart();
            
            console.log("processPosPayment: About to hide modal."); // Trace 9
            const modalInstance = bootstrap.Modal.getInstance(posModalElement);
            if (modalInstance) {
                modalInstance.hide();
                console.log("processPosPayment: Modal hide called."); // Trace 10
            } else {
                console.log("processPosPayment: Modal instance not found for hiding."); // Trace 11
            }
            console.log("processPosPayment: Function ended."); // Trace 12
        }

        if (posModalElement) { // ADDING A CONSOLE LOG FOR MEALKITZCONFIG HERE
            console.log("Initial mealkitzConfig on DOMContentLoaded:", JSON.stringify(mealkitzConfig)); 
            posModalElement.addEventListener('show.bs.modal', () => {
                // Ensure commonLoginCheck is performed just before showing the modal fully
                // The gating should ideally happen on the trigger click, which is already set up.
                // This is more for re-initializing content.
                renderPosProducts(posProductFilterInput ? posProductFilterInput.value : '');
                clearPosCart(); // Start with a fresh cart view
            });
        }
        
        if (posProductFilterInput) {
            posProductFilterInput.addEventListener('input', () => renderPosProducts(posProductFilterInput.value));
        }
        if (posClearCartBtn) {
            posClearCartBtn.addEventListener('click', clearPosCart);
        }
        if (posProcessPaymentBtn) {
            posProcessPaymentBtn.addEventListener('click', processPosPayment);
        }

        // Ensure the commonLoginCheck targets the new POS modal
        // This replaces/updates the old #manualChargeModal trigger logic
        document.querySelectorAll('[data-bs-target="#basicPosModal"]').forEach(trigger => {
            trigger.addEventListener('click', function(event) {
                commonLoginCheck(event, { page: 'punto.html', hash: '#basicPosModal' });
            });
        });
        // Remove or update the old #manualChargeModal specific trigger if it still exists elsewhere
        document.querySelectorAll('[data-bs-target="#manualChargeModal"]').forEach(trigger => {
             // This is to ensure no old triggers for manualChargeModal are left hanging if basicPosModal is the new primary
             // If manualChargeModal is still used for other purposes, this might need adjustment.
            trigger.addEventListener('click', function(event) {
                console.warn("Trigger for #manualChargeModal activated. Ensure this is intended if #basicPosModal is primary.");
                commonLoginCheck(event, { page: 'punto.html', hash: '#manualChargeModal' }); 
            });
        });

        // --- END Basic POS Modal Logic ---

        // Cargar configuración (negocio, productos, métodos de pago) desde localStorage
        // ... existing code ...
      }); // This is the closing for DOMContentLoaded
    </script>

    <footer class="text-center py-3 mt-auto bg-light">
      <div class="container d-flex justify-content-center align-items-center">
        
        <span class="text-muted small">Powered by</span> <img src="images/mk_logo.jpeg" alt="Mealkitz Logo" style="height: 24px; width: auto; margin-right: 8px;">
      </div>
    </footer>
  </body>
</html>
