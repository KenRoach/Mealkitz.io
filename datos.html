<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mealkitz</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <!-- Custom Styles -->
    <style>
      body {
        font-family: 'Poppins', sans-serif;
        background-color: #f8f9fa;
        padding-top: 1rem;
      }
      .navbar {
        box-shadow: 0 2px 4px rgba(0,0,0,.1);
        background-color: #fff;
        margin-bottom: 1rem;
      }
      .navbar-brand {
        font-weight: 600;
        color: #123A62 !important;
      }
      .navbar-brand img {
        max-height: 35px;
      }
      .navbar-brand span {
        font-size: 1.25rem;
        margin-left: 0.5rem;
      }
      .navbar-toggler {
        border: none;
      }
      .navbar-toggler-icon {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(18,58,98,0.8)' stroke-width='2' stroke-linecap='round' stroke-miterlimit='10' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
      }
      .btn, .btn-link {
        outline: none!important;
        box-shadow: none!important;
        border: none!important;
      }
      .btn-primary {
        background-color: #123A62;
        color: #fff;
      }
      .btn-primary:hover {
        background-color: #0e3150;
        color: #fff;
      }
      .lead {
        color: #6c757d;
      }
      .container-main {
        background: #fff;
        padding: 2rem;
        border-radius: .5rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        margin-top: 1rem;
      }
      .table-responsive {
        max-height: 300px;
        overflow-y: auto;
      }
      .card-value {
        font-size: 3em;
        margin-bottom: .5rem;
        color: #123A62;
        font-weight: 600;
        text-align: center;
      }
      .card-label {
        color: #6c757d;
        font-size: 0.9rem;
        text-align: center;
      }
      @media (max-width: 575.98px) {
        .card-value {
          font-size: 2.25em;
          margin-bottom: .25rem;
        }
        .card-label {
          font-size: 0.8rem;
        }
      }
      #navbarIcons.collapsing {
        height: 0;
        overflow: hidden;
        transition: height 0.5s ease-in-out;
      }

      /* Custom Navbar Link Styling (copied from punto.html) */
      @media (max-width: 767.98px) { /* Bootstrap's md breakpoint */
        .navbar-collapse .navbar-nav .nav-item {
          text-align: center;
        }
        .navbar-collapse .navbar-nav .nav-link {
          padding-top: 0.75rem;
          padding-bottom: 0.75rem;
        }
        .navbar-collapse .navbar-nav {
          margin-top: 0.5rem;
        }
        .navbar-collapse .navbar-nav.me-auto {
            margin-right: 0 !important;
            margin-left: 0 !important;
            width: 100%;
        }
         .navbar-collapse .d-flex.ms-auto {
            width: 100%;
            justify-content: center;
            margin-top: 0.5rem;
            padding-bottom: 0.5rem;
        }
      }

      @media (min-width: 768px) {
        .navbar-collapse ul.navbar-nav.me-auto {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }
      }

      .navbar-nav .nav-link {
        transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
      }
      .navbar-nav .nav-link:hover,
      .navbar-nav .nav-link:focus {
        background-color: #e9ecef;
        color: #0056b3;
        border-radius: 0.375rem;
      }
      .navbar-nav .nav-link i {
        font-size: 1.1em;
        vertical-align: text-bottom;
        margin-right: 0.35em !important;
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-light bg-white navbar-expand-md py-2">
      <div class="container-fluid px-4">
        <a class="navbar-brand d-flex align-items-center" href="index.html">
          <img
            src="Images/mk_logo.jpeg"
            style="height: 35px; margin-right: 5px;"
            alt="Mealkitz Logo"
          />
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarIcons"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
    
        <div class="collapse navbar-collapse" id="navbarIcons">
          <!-- IZQUIERDA: enlaces a cada acción -->
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <!-- Ingresar tus Datos -->
            <li class="nav-item">
              <a class="nav-link" href="config.html">
                <i class="bi bi-person-badge-fill me-1"></i>
                Ingresar tus Datos
              </a>
            </li>
    
            <!-- Cobro Manual (abre modal) -->
            <li class="nav-item">
              <a class="nav-link" id="cobroManualRedirectLink" href="punto.html">
                <i class="bi bi-cash-coin me-1"></i>
                Cobro Manual
              </a>
            </li>
    
            <!-- Generar Cotización (abre modal en punto.html) -->
            <li class="nav-item">
              <a class="nav-link" id="cotizacionRedirectLink" href="punto.html">
                <i class="bi bi-file-earmark-text-fill me-1"></i>
                Generar Cotización
              </a>
            </li>
    
            <!-- Cobro con QR (abre modal "Próximamente") -->
            <li class="nav-item">
              <a
                class="nav-link"
                href="#"
                data-bs-toggle="modal"
                data-bs-target="#proximamenteQRModal"
              >
                <i class="bi bi-qr-code me-1"></i>
                Cobro con QR
              </a>
            </li>
    
            <!-- Tu Tienda En Línea -->
            <li class="nav-item">
              <a class="nav-link" href="e-commerce.html">
                <i class="bi bi-shop me-1"></i>
                Tu Tienda En Línea
              </a>
            </li>
    
            <!-- Pedidos -->
            <li class="nav-item">
              <a class="nav-link" href="pedidos.html">
                <i class="bi bi-box-seam me-1"></i>
                Pedidos
              </a>
            </li>
    
            <!-- Ayuda -->
            <li class="nav-item">
              <a class="nav-link" href="ayuda.html">
                <i class="bi bi-question-circle-fill me-1"></i>
                Ayuda
              </a>
            </li>
          </ul>
    
          <!-- DERECHA: notificaciones, compartir, perfil y buscador -->
          <div class="d-flex align-items-center ms-auto">
            <button class="btn btn-link text-dark me-3" title="Notificaciones">
              <i class="bi bi-bell-fill fs-4"></i>
            </button>
            <a
              href="#"
              id="whatsapp-share-btn"
              class="btn btn-link text-dark me-3"
              title="Compartir en WhatsApp"
            >
              <i class="bi bi-whatsapp fs-4"></i>
            </a>
            <div class="nav-item dropdown">
              <a
                href="#"
                class="btn btn-link text-dark me-3 dropdown-toggle d-flex align-items-center"
                id="profileDropdown"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                title="Perfil"
              >
                <img
                  id="profileImageLogo"
                  src=""
                  alt="Profile Logo"
                  style="height: 28px; width: 28px; border-radius: 50%; margin-right: 8px; display: none;"
                />
                <i class="bi bi-person-circle fs-4 me-2" id="defaultProfileIcon"></i>
                <span id="profileDropdownName">Perfil</span>
              </a>
              <ul
                class="dropdown-menu dropdown-menu-end"
                aria-labelledby="profileDropdown"
                id="profileDropdownMenu"
              >
                <li>
                  <a class="dropdown-item" href="perfil.html" id="viewProfileLink"
                    >Crear Perfil</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    href="iniciar.html"
                    id="loginOrLogoutLink"
                    >Iniciar Sesión</a
                  >
                </li>
              </ul>
            </div>
            <a href="ayuda.html" class="btn btn-link text-dark me-3" title="Buscar">
              <i class="bi bi-search fs-4"></i>
            </a>
          </div>
        </div>
      </div>
    </nav>


    <main class="container container-main">
      
      <!-- Top Row Key Metrics -->
      <div class="row justify-content-center text-center mb-4 g-3">
        <div class="col-lg-6 mb-3 mb-lg-0"> <!-- Left Column -->
          <div class="row g-3">
            <div class="col-12">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title text-muted">Ingresos Totales</h5>
                  <p class="card-text fs-2 fw-bold text-primary mb-0">$12,345</p> 
                </div>
              </div>
            </div>
            <div class="col-12">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title text-muted">Ganancia Neta</h5>
                  <p class="card-text fs-2 fw-bold text-warning mb-0">$4,000</p> 
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-6"> <!-- Right Column -->
          <div class="row g-3">
            <div class="col-12">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title text-muted">Ticket Promedio</h5>
                  <p class="card-text fs-2 fw-bold text-success mb-0">$100</p> 
                </div>
              </div>
            </div>
            <div class="col-12">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title text-muted">Satisfacción WhatsApp</h5>
                  <p class="card-text fs-2 fw-bold text-info mb-0">85%</p> 
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Chart Section -->
      <div class="row mb-4 g-3">
        <div class="col-lg-8">
          <div class="card shadow-sm">
            <div class="card-header bg-light">
              <h6 class="my-1"><i class="bi bi-bar-chart-line-fill me-2"></i>Ingresos vs. Ganancia (Últimos 4 Meses)</h6>
            </div>
            <div class="card-body">
              <canvas id="ingresosGananciaChart"></canvas>
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="card shadow-sm">
            <div class="card-header bg-light">
              <h6 class="my-1"><i class="bi bi-pie-chart-fill me-2"></i>Nivel de Satisfacción por WhatsApp</h6>
            </div>
            <div class="card-body">
              <canvas id="satisfaccionChart" style="max-height: 250px;"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="row mb-4">
        <div class="col-12">
          <div class="card shadow-sm">
            <div class="card-header bg-light">
              <h6 class="my-1"><i class="bi bi-graph-up me-2"></i>Tendencia de Vistas y Engagement (Semanal)</h6>
            </div>
            <div class="card-body">
              <canvas id="vistasEngagementChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- AI Mode Button -->
      <div class="d-flex justify-content-center pt-3">
        <button class="btn btn-success" onclick="showRecommendations()">
          <i class="bi bi-lightbulb-fill me-2"></i>Recomendaciones
        </button>
      </div>
    </main>

    <!-- Details Modal -->
    <div class="modal fade" id="detailsModal" tabindex="-1" aria-labelledby="detailsModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="detailsModalLabel">Resumen de Ventas</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>Lista de ventas individuales realizadas en los últimos 30 días.</p>
            <div class="table-responsive">
              <table class="table table-sm table-striped">
                <thead class="table-light">
                  <tr>
                    <th># Orden</th>
                    <th>Producto(s)</th>
                    <th>Precio</th>
                    <th>Margen (%)</th>
                  </tr>
                </thead>
                <tbody id="details-table-body">
                  <tr><td colspan="5" class="text-center text-muted">Cargando ventas...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- AI Insights Modal -->
    <div class="modal fade" id="aiModal" tabindex="-1" aria-labelledby="aiModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="aiModalLabel">Recomendaciones</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            <button id="export-btn" type="button" class="btn btn-success btn-lg">
              <i class="bi bi-file-earmark-spreadsheet me-1"></i> Exportar Pedidos CSV
            </button>
          </div>
          <div class="modal-body">
            <ul>
              <li><strong>Empezar:</strong> Ofrecer un <strong>10% de descuento</strong> en todos los Sushi Rolls durante los próximos 30 días para aumentar las ventas.</li>
              <li><strong>Detener:</strong> Centrar las promociones solo fuera del horario de almuerzo; no descuidar otras franjas horarias.</li>
              <li><strong>Continuar:</strong>  
                <ul>
                  <li>Promocionar el <strong>Sushi Roll de Atún</strong>, cuyas ventas crecieron un <strong>15%</strong>.</li>
                  <li>Mantener el impulso en los <strong>Sushi Rolls</strong>, con un aumento del <strong>12%</strong> en los últimos 7 días.</li>
                </ul>
              </li>
            </ul>
            
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de Inicio de Sesión Requerido -->
    <div class="modal fade" id="loginRequiredModal" tabindex="-1" aria-labelledby="loginRequiredModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="loginRequiredModalLabel"><i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>Inicio de Sesión Requerido</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <p>Para acceder a esta función, por favor, inicia sesión o crea una cuenta.</p>
          </div>
          <div class="modal-footer justify-content-center">
            <a href="iniciar.html" class="btn btn-primary">Iniciar Sesión</a>
            <a href="iniciar.html?action=register" class="btn btn-success">Crear Cuenta</a>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS Bundle (Ensure this is present) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // --- BEGIN NEW FEATURE GATING AND LOGIN CHECK (datos.html) ---
        const loginRequiredModalEl = document.getElementById('loginRequiredModal');
        const loginRequiredModalInstance = loginRequiredModalEl ? new bootstrap.Modal(loginRequiredModalEl) : null;
        let postLoginRedirectData = null;

        try {
            const postLoginRedirectRAW = sessionStorage.getItem('postLoginRedirect');
            if (postLoginRedirectRAW) {
                postLoginRedirectData = JSON.parse(postLoginRedirectRAW);
            }
        } catch (e) {
            console.error("Error parsing postLoginRedirect from sessionStorage (datos.html):", e);
            sessionStorage.removeItem('postLoginRedirect');
        }

        const currentUser = localStorage.getItem('currentUser_mealkitz');

        // If not logged in AND no postLoginRedirect is active for *this* page (datos.html),
        // redirect to login. This protects direct access to datos.html if not logged in.
        if (!currentUser && (!postLoginRedirectData || postLoginRedirectData.page !== 'datos.html')) {
            window.location.href = 'iniciar.html?redirect=datos.html'; // Add redirect param for context
            return; // Stop further script execution on this page
        }

        const commonLoginCheck = (event, destination) => {
            if (!currentUser) { // currentUser is already fetched
                if (event) event.preventDefault();
                if (loginRequiredModalInstance) {
                    sessionStorage.setItem('postLoginRedirect', JSON.stringify(destination));
                    loginRequiredModalInstance.show();
                } else {
                    console.error('Login Required Modal not found or initialized on datos.html.');
                    window.location.href = 'iniciar.html'; // Fallback redirect
                }
                return false;
            }
            return true;
        };

        // After login, if redirected back with a hash for a modal on *this* page (datos.html):
        if (postLoginRedirectData && postLoginRedirectData.page === 'datos.html' && postLoginRedirectData.hash) {
            const targetModalId = postLoginRedirectData.hash.substring(1); // remove #
            const modalElement = document.getElementById(targetModalId);
            if (modalElement) {
                const modalInstance = bootstrap.Modal.getInstance(modalElement) || new bootstrap.Modal(modalElement);
                if (modalInstance) modalInstance.show();
            }
            sessionStorage.removeItem('postLoginRedirect'); // Clear after processing
        }

        // Gate specific links
        // 1. Cobro Manual link to punto.html#manualChargeModal
        const cobroManualLink = document.getElementById('cobroManualRedirectLink');
        if (cobroManualLink) {
            cobroManualLink.addEventListener('click', function(event) {
                commonLoginCheck(event, { page: 'punto.html', hash: '#manualChargeModal' });
            });
        }

        // 2. Ingresar tus Datos (config.html)
        document.querySelectorAll('a[href="config.html"]').forEach(link => {
            link.addEventListener('click', function(event) {
                commonLoginCheck(event, { page: 'config.html' });
            });
        });

        // 3. Generar Cotización link to punto.html#cotizacionModal
        const cotizacionLink = document.getElementById('cotizacionRedirectLink');
        if (cotizacionLink) {
            cotizacionLink.addEventListener('click', function(event) {
                commonLoginCheck(event, { page: 'punto.html', hash: '#cotizacionModal' });
            });
        }

        // 4. Cobro con QR (currently a local modal trigger for #proximamenteQRModal)
        // This modal also does not exist on datos.html. Gated for consistency.
        document.querySelectorAll('[data-bs-target="#proximamenteQRModal"]').forEach(trigger => {
            trigger.addEventListener('click', function(event) {
                commonLoginCheck(event, { page: 'datos.html', hash: '#proximamenteQRModal' });
            });
        });

        // 5. Tu Tienda En Línea (e-commerce.html)
        document.querySelectorAll('a[href="e-commerce.html"]').forEach(link => {
            link.addEventListener('click', function(event) {
                commonLoginCheck(event, { page: 'e-commerce.html' });
            });
        });

        // 6. Pedidos (pedidos.html)
        document.querySelectorAll('a[href="pedidos.html"]').forEach(link => {
            link.addEventListener('click', function(event) {
                commonLoginCheck(event, { page: 'pedidos.html' });
            });
        });
        
        // 7. Perfil link from dropdown (perfil.html)
        const viewProfileLink = document.getElementById('viewProfileLink');
        if (viewProfileLink && viewProfileLink.getAttribute('href') === 'perfil.html') {
            viewProfileLink.addEventListener('click', function(event) {
                 commonLoginCheck(event, { page: 'perfil.html' });
            });
        }

        // --- END NEW FEATURE GATING AND LOGIN CHECK ---

        // Dummy data for charts
        const monthlyData = {
          labels: ['Enero', 'Febrero', 'Marzo', 'Abril'],
          ingresos: [12000, 15000, 13500, 16000],
          ganancia: [4000, 5500, 4800, 6200]
        };

        const weeklyTrendData = {
          labels: ['Semana 1', 'Semana 2', 'Semana 3', 'Semana 4', 'Semana 5'],
          vistas: [1500, 1700, 1600, 1900, 2100],
          engagement: [300, 350, 320, 400, 450]
        };

        const satisfaccionData = {
          value: 85, // Percentage
          remaining: 15
        };

        // Ingresos vs Ganancia Chart (Bar)
        const ingresosGananciaCtx = document.getElementById('ingresosGananciaChart').getContext('2d');
        new Chart(ingresosGananciaCtx, {
          type: 'bar',
          data: {
            labels: monthlyData.labels,
            datasets: [
              {
                label: 'Ingresos ($)',
                data: monthlyData.ingresos,
                backgroundColor: 'rgba(54, 162, 235, 0.6)', // Blue
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
              },
              {
                label: 'Ganancia ($)',
                data: monthlyData.ganancia,
                backgroundColor: 'rgba(75, 192, 192, 0.6)', // Green
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
              }
            ]
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });

        // Nivel de Satisfacción Chart (Doughnut)
        const satisfaccionCtx = document.getElementById('satisfaccionChart').getContext('2d');
        new Chart(satisfaccionCtx, {
          type: 'doughnut',
          data: {
            labels: ['Satisfacción', 'Restante'],
            datasets: [{
              label: 'Satisfacción WhatsApp',
              data: [satisfaccionData.value, satisfaccionData.remaining],
              backgroundColor: [
                'rgba(255, 206, 86, 0.7)', // Yellow for satisfaction
                'rgba(230, 230, 230, 0.7)'  // Light grey for remaining
              ],
              borderColor: [
                'rgba(255, 206, 86, 1)',
                'rgba(200, 200, 200, 1)'
              ],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false, // Important for doughnut chart in smaller containers
            plugins: {
              legend: {
                position: 'bottom',
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    let label = context.label || '';
                    if (label) {
                      label += ': ';
                    }
                    if (context.parsed !== null) {
                      label += context.parsed + '%';
                    }
                    return label;
                  }
                }
              }
            }
          }
        });

        // Vistas y Engagement Chart (Line)
        const vistasEngagementCtx = document.getElementById('vistasEngagementChart').getContext('2d');
        new Chart(vistasEngagementCtx, {
          type: 'line',
          data: {
            labels: weeklyTrendData.labels,
            datasets: [
              {
                label: 'Vistas',
                data: weeklyTrendData.vistas,
                borderColor: 'rgba(255, 99, 132, 1)', // Red
                backgroundColor: 'rgba(255, 99, 132, 0.1)',
                tension: 0.1,
                fill: true
              },
              {
                label: 'Engagement',
                data: weeklyTrendData.engagement,
                borderColor: 'rgba(153, 102, 255, 1)', // Purple
                backgroundColor: 'rgba(153, 102, 255, 0.1)',
                tension: 0.1,
                fill: true
              }
            ]
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });

        // Existing script for AI Modal and Details Modal can go here or remain separate
        // Ensure this doesn't conflict if they also use DOMContentLoaded
      });

      // Function to show AI recommendations (if you want to keep it separate)
      function showRecommendations() {
        var aiModal = new bootstrap.Modal(document.getElementById('aiModal'));
        aiModal.show();
      }

      // Function to populate details modal (if you want to keep it separate)
      // This would typically fetch data, but here's a placeholder structure
      function populateDetailsModal() {
        const tableBody = document.getElementById('details-table-body');
        tableBody.innerHTML = ''; // Clear existing rows
        // Example static data - replace with actual data fetching and loop
        const salesData = [
          { order: '#123', product: 'Sushi Roll Mix', price: '$25.50', margin: '30%' },
          { order: '#124', product: 'Bebida Grande', price: '$5.00', margin: '50%' },
          { order: '#125', product: 'Postre Especial', price: '$8.75', margin: '25%' }
        ];
        if (salesData.length > 0) {
          salesData.forEach(sale => {
            const row = tableBody.insertRow();
            row.insertCell().textContent = sale.order;
            row.insertCell().textContent = sale.product;
            row.insertCell().textContent = sale.price;
            row.insertCell().textContent = sale.margin;
          });
        } else {
          tableBody.innerHTML = '<tr><td colspan="4" class="text-center text-muted">No hay datos de ventas detalladas disponibles.</td></tr>';
        }
      }
      // Event listener for the details modal to populate data when shown
      const detailsModal = document.getElementById('detailsModal');
      if (detailsModal) {
        detailsModal.addEventListener('show.bs.modal', populateDetailsModal);
      }

      drawCharts();
    </script>
    <script src="js/auth-navbar.js" defer></script>
  </body>
</html>
